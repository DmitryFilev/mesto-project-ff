(()=>{"use strict";var e,t,n,r=function(e,t,n,r,c){var o="";switch(n){case"GET":case"DELETE":case"PUT":o={method:n,headers:e.headers};break;case"PATCH":case"POST":o={method:n,headers:e.headers,body:JSON.stringify(r)}}return fetch("".concat(e.baseUrl,"/").concat(t),o).then((function(e){return e.ok?e.json():Promise.reject("код ошибки: ".concat(e.status))}))},c=function(t,n){t.classList.add(n),e=function(e){a(e,n)},document.addEventListener("keydown",e)},o=function(t,n){t.classList.remove(n),t.id="",document.removeEventListener("keydown",e)},a=function(e,t){"Escape"===e.key&&o(document.querySelector("."+t),t)},i={},u=function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?s(e,t):l(e,t,t.validationMessage)},l=function(e,t,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.add(i.inputErrorClass),r.textContent=n,r.classList.add(i.errorClassVisible)},s=function(e,t){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(i.inputErrorClass),n.classList.remove(i.errorClassVisible),n.textContent=""},d=function(e,t){f(e)?(t.disabled=!0,t.classList.add(i.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(i.inactiveButtonClass))},f=function(e){return e.some((function(e){return!e.validity.valid}))},p=function(e){return 0===e.indexOf(".")?e:".".concat(e)},m=function(e,t){var n=Array.from(e.querySelectorAll(p(t.inputSelector))),r=e.querySelector(p(t.submitButtonSelector));r.classList.add(t.inactiveButtonClass),r.disabled=!0,n.forEach((function(t){s(e,t)}))},_=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),b=document.forms["edit-profile"],h=b.name,q=b.description,E=document.forms["edit-avatar"],k=E.link,L=document.querySelector(".avatar__edit-button"),C=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__edit-button"),A=document.querySelector(".popup_type_new-card"),x=document.querySelector(".profile__add-button"),T=document.forms["new-place"],D=document.forms["del-card"],P=T["place-name"],w=T.link,B="places__item",V="popup_is-opened",M="card__like-button",N="card__like-title",O="card__like-button_is-active",U="popup__button",j="card__title",G=document.querySelector(".popup_type_image"),H=document.querySelector(".popup__image"),z=document.querySelector(".popup__caption"),J=document.querySelector(".popup_type_del-card"),F=document.querySelector(".popup_type_edit-avatar"),I="1",K={baseUrl:"https://mesto.nomoreparties.co/v1/pwff-cohort-1",headers:{authorization:"c0633bfb-20c9-4f83-879b-8806458fc25b","Content-Type":"application/json"}},Q="[A-z А-яё\\-]+",R={formSelector:"popup__form",inputSelector:"popup__input",submitButtonSelector:U,inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error-line",errorClassVisible:"popup__error_visible",errorMess:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"},W=function(){return r(K,"cards","GET")},X=function(){return W().then((function(e){Array.from(_.querySelectorAll(".".concat(B))).forEach((function(e){return e.remove()})),Z(e)})).catch((function(e){return alert("Ошибка перезагрузки карт-".concat(e))}))},Y=function(e){v.textContent=e.name,y.textContent=e.about,S.style="background-image: url('".concat(e.avatar,"');\""),I=e._id},Z=function(e){return e.forEach((function(e){return _.append(function(e,t,n){var r=document.querySelector("#"+t.id).content.querySelector("."+t.core).cloneNode(!0);if(r.querySelector("."+t.img).src=e.link,r.querySelector("."+t.img).alt=e.name+". Панорамный вид.",r.querySelector("."+t.title).textContent=e.name,r.querySelector("."+t.likeCount).textContent=e.likes.length,e.likes.some((function(e){return e._id===n}))&&r.querySelector("."+t.like).classList.add(t.likeAct),r.id="id_".concat(e._id),r.querySelector("."+t.like).addEventListener("click",(function(e){t.funcLike(e.target)})),e.owner._id===n){var c=r.querySelector("."+t.del);c.classList.add(t.btnDelVisible),c.addEventListener("click",(function(e){t.funcDel(e.target.parentNode.id)}))}return r.querySelector("."+t.img).addEventListener("click",t.funcClick),r}(e,te,I))}))},$=function(e){if(e.target.classList.contains(V)){var t=e.target;o(t,V)}},ee=function(e){var t=e.target.closest("."+V);o(t,V)},te={id:"card-template",core:"places__item",title:j,del:"card__delete-button",like:M,likeAct:O,likeCount:N,img:"card__image",btnDelVisible:"card__delete-visible",funcClick:function(e){H.src=e.target.src,H.alt=e.target.alt,z.textContent=e.target.parentNode.querySelector(".".concat(j)).textContent,c(G,V)},funcDel:function(e){J.id=e,c(J,V)},funcLike:function(e){var t=e.closest(".".concat(B)),n=e.classList.contains(O),c=t.id.slice(3);n?(e.classList.remove(O),r(K,"cards/likes/".concat(c),"DELETE","").then((function(e){return ne(e)})).catch((function(e){return alert("Ошибка удаления like-".concat(e))}))):(e.classList.add(O),r(K,"cards/likes/".concat(c),"PUT","").then((function(e){return ne(e)})).catch((function(e){return alert("Ошибка проставления like-".concat(e))})))}},ne=function(e){var t=e._id,n=e.likes.length,r=e.likes.some((function(e){return e._id===I})),c=document.querySelector("#id_".concat(t)),o=c.querySelector(".".concat(M));return c.querySelector(".".concat(N)).textContent=n,r?o.classList.add(O):o.classList.remove(O),[t,n,r]},re=function(e){var t=e.target.querySelector(".".concat(U)),n=t.textContent;"..."===n.slice(-3)?t.textContent=n.slice(0,-3):t.textContent=n+"..."};n=[[h,Q],[q,Q],[P,Q]],i=t=R,function(e){e.forEach((function(e){e[0].setAttribute("minlength",e[1]),e[0].setAttribute("maxlength",e[2])}))}([[h,2,40],[q,2,200],[P,2,30]]),n.forEach((function(e){e[0].setAttribute("pattern",e[1]),e[0].setAttribute("data-error-message",i.errorMess)})),Array.from(document.querySelectorAll(p(i.formSelector))).forEach((function(e){(function(e,t){Array.from(e.querySelectorAll(p(t))).forEach((function(t){if(!e.querySelector(".".concat(t.name,"-error"))){var n=document.createElement("span");n.classList.add("".concat(t.name,"-error")),n.classList.add(i.errorClass),t.after(n)}}))})(e,t.inputSelector),function(e){var t=Array.from(e.querySelectorAll(p(i.inputSelector))),n=e.querySelector(p(i.submitButtonSelector));t.forEach((function(r){r.addEventListener("input",(function(){u(e,r),d(t,n)}))}))}(e)})),document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",$),e.querySelector(".popup__close").addEventListener("click",ee)})),x.addEventListener("click",(function(){P.value="",w.value="",m(A,R),c(A,V)})),g.addEventListener("click",(function(){h.value=v.textContent,q.value=y.textContent,m(C,R),c(C,V)})),L.addEventListener("click",(function(){m(F,R),k.value="",c(F,V)})),T.addEventListener("submit",(function(e){e.preventDefault(),re(e),r(K,"cards","POST",{name:P.value,link:w.value}).then((function(t){alert("Карточка ".concat(t.name," добавлена")),X(),re(e),o(A,V)})).catch((function(e){return alert("Ошибка добавления карты-".concat(e))}))})),D.addEventListener("submit",(function(e){e.preventDefault();var t=J.id.slice(3);r(K,"cards/".concat(t),"DELETE","").then((function(e){alert(e.message),X(),o(J,V)})).catch((function(e){return alert("Ошибка удаления карты-".concat(e))}))})),b.addEventListener("submit",(function(e){e.preventDefault(),re(e),r(K,"users/me","PATCH",{name:h.value,about:q.value}).then((function(t){Y(t),re(e),o(C,V)})).catch((function(e){return alert("Ошибка редактирования профиля-".concat(e))}))})),E.addEventListener("submit",(function(e){e.preventDefault(),re(e),r(K,"users/me/avatar","PATCH",{avatar:k.value}).then((function(t){Y(t),re(e),o(F,V)})).catch((function(e){return alert("Ошибка редактирования аватар-".concat(e))}))})),Promise.all([r(K,"users/me","GET"),W()]).then((function(e){Y(e[0]),Z(e[1])})).catch((function(e){return alert("Ошибка начальной загрузки-".concat(e))}))})();